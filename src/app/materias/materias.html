<!-- MATERIAS.HTML -->
<div class="materias-wrapper">
  <header>
    <app-encabezado></app-encabezado>
  </header>

  <div class="main-layout">
    <aside class="sidebar">
      <app-menu [userType]="'estudiante'"></app-menu>
    </aside>

    <main class="content">
      <div class="page-header">
        <h1>ğŸ“š Mis Materias</h1>
        <p class="subtitle">Gestiona tus materias del semestre</p>
      </div>

      <!-- Toolbar -->
      <div class="toolbar">
        <div class="search-container">
          <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          <input
            type="text"
            class="search-input"
            placeholder="Buscar materia por nombre, profesor o aula..."
            [(ngModel)]="busqueda"
            (ngModelChange)="buscarMaterias()"
          />
        </div>
        <button class="btn-add" (click)="toggleFormulario()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          {{ mostrarFormulario ? 'Cancelar' : 'Nueva Materia' }}
        </button>
      </div>

      <!-- Formulario -->
      <div class="form-container" *ngIf="mostrarFormulario">
        <div class="form-header">
          <h3>{{ editando ? 'âœï¸ Editar Materia' : 'â• Agregar Nueva Materia' }}</h3>
          <button class="btn-close" (click)="toggleFormulario()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>

        <form (submit)="editando ? guardarEdicion() : agregarMateria(); $event.preventDefault()" class="form-grid">
          <div class="form-group">
            <label>Nombre de la Materia *</label>
            <input
              type="text"
              placeholder="Ej: CÃ¡lculo Diferencial"
              [(ngModel)]="nuevaMateria.nombre"
              name="nombre"
              required
            />
          </div>

          <div class="form-group">
            <label>Profesor *</label>
            <input
              type="text"
              placeholder="Ej: Dr. Juan PÃ©rez"
              [(ngModel)]="nuevaMateria.profesor"
              name="profesor"
              required
            />
          </div>

          <div class="form-group">
            <label>Semestre *</label>
            <input
              type="number"
              placeholder="1-10"
              [(ngModel)]="nuevaMateria.semestre"
              name="semestre"
              min="1"
              max="10"
              required
            />
          </div>

          <div class="form-group">
            <label>Horario *</label>
            <input
              type="text"
              placeholder="Ej: 8:00 - 10:00"
              [(ngModel)]="nuevaMateria.horario"
              name="horario"
              required
            />
          </div>

          <div class="form-group">
            <label>Aula *</label>
            <input
              type="text"
              placeholder="Ej: A-301"
              [(ngModel)]="nuevaMateria.aula"
              name="aula"
              required
            />
          </div>

          <div class="form-group">
            <label>CrÃ©ditos</label>
            <input
              type="number"
              [(ngModel)]="nuevaMateria.creditos"
              name="creditos"
              min="1"
              max="10"
            />
          </div>

          <div class="form-group full-width">
            <label>DÃ­as de la Semana *</label>
            <div class="dias-semana">
              <button
                type="button"
                *ngFor="let dia of diasSemanaOpciones"
                class="dia-btn"
                [class.selected]="isDiaSeleccionado(dia.value)"
                (click)="toggleDia(dia.value)"
              >
                {{ dia.label }}
              </button>
            </div>
          </div>

          <div class="form-group full-width">
            <label>Color de IdentificaciÃ³n</label>
            <div class="colores-container">
              <button
                type="button"
                *ngFor="let color of coloresDisponibles"
                class="color-btn"
                [style.background-color]="color"
                [class.selected]="nuevaMateria.color === color"
                (click)="nuevaMateria.color = color"
              ></button>
            </div>
          </div>

          <div class="form-group full-width">
            <label>DescripciÃ³n (Opcional)</label>
            <textarea
              [(ngModel)]="nuevaMateria.descripcion"
              name="descripcion"
              placeholder="Notas adicionales sobre la materia..."
              rows="3"
            ></textarea>
          </div>

          <div class="form-actions full-width">
            <button type="button" class="btn-secondary" (click)="limpiarFormulario()">
              ğŸ—‘ï¸ Limpiar
            </button>
            <button type="submit" class="btn-primary">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
              {{ editando ? 'Actualizar Materia' : 'Guardar Materia' }}
            </button>
          </div>
        </form>
      </div>

      <!-- Grid de Materias -->
      <div class="materias-grid" *ngIf="materiasFiltradas.length > 0; else sinMaterias">
        <div 
          class="materia-card" 
          *ngFor="let materia of materiasFiltradas"
          [style.border-left-color]="materia.color"
          (click)="seleccionarMateria(materia)"
          [class.selected]="materiaSeleccionada?.id === materia.id"
        >
          <div class="materia-header">
            <div class="materia-info">
              <h3>{{ materia.nombre }}</h3>
              <p class="profesor">ğŸ‘¨â€ğŸ« {{ materia.profesor }}</p>
            </div>
            <div class="materia-actions">
              <button class="btn-icon btn-edit" (click)="editarMateria(materia); $event.stopPropagation()" title="Editar">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                </svg>
              </button>
              <button class="btn-icon btn-delete" (click)="eliminarMateria(materia.id); $event.stopPropagation()" title="Eliminar">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"/>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                </svg>
              </button>
            </div>
          </div>

          <div class="materia-details">
            <div class="detail-item">
              <span class="icon">ğŸ«</span>
              <span>{{ materia.aula }}</span>
            </div>
            <div class="detail-item">
              <span class="icon">ğŸ•</span>
              <span>{{ materia.horario }}</span>
            </div>
            <div class="detail-item">
              <span class="icon">ğŸ“…</span>
              <span>{{ materia.diasSemana.join(', ') }}</span>
            </div>
            <div class="detail-item">
              <span class="icon">ğŸ“Š</span>
              <span>{{ materia.creditos }} crÃ©ditos</span>
            </div>
          </div>

          <div class="materia-footer" *ngIf="materiaSeleccionada?.id === materia.id">
            <div class="tareas-count">
              <span>ğŸ“ {{ obtenerTareasPorMateria(materia.id).length }} tareas</span>
            </div>
            <p class="descripcion" *ngIf="materia.descripcion">{{ materia.descripcion }}</p>
          </div>
        </div>
      </div>

      <ng-template #sinMaterias>
        <div class="empty-state">
          <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
          </svg>
          <h3>No hay materias registradas</h3>
          <p>Comienza agregando tu primera materia usando el botÃ³n "Nueva Materia"</p>
        </div>
      </ng-template>
    </main>
  </div>

  <app-footer></app-footer>
</div>