<div class="perfil-container">

  <app-encabezado></app-encabezado>

  <!-- SecciÃ³n del avatar y datos principales -->
  <div class="perfil-header">
    <div class="avatar-section">
      <div class="avatar-wrapper">
        <img 
          [src]="usuario.avatar || 'https://ui-avatars.com/api/?name=' + usuario.nombre + '+' + usuario.apellido + '&size=200&background=1F2041&color=fff'" 
          alt="Avatar"
          class="avatar-img">
        <label for="avatar-input" class="avatar-edit" *ngIf="editMode">
          <span>ğŸ“·</span>
          <input 
            type="file" 
            id="avatar-input" 
            accept="image/*"
            (change)="onFileSelected($event)"
            style="display: none;">
        </label>
      </div>
      <div class="usuario-info">
        <h1 class="nombre-usuario">{{ usuario.nombre }} {{ usuario.apellido }}</h1>
        <p class="email-usuario">{{ usuario.email }}</p>
        <p class="carrera-usuario">{{ usuario.carrera }} - Semestre {{ usuario.semestre }}</p>
      </div>
    </div>

    <div class="acciones-header">
      <button class="btn-accion" (click)="activarEdicion()" *ngIf="!editMode">
        âœï¸ Editar Perfil
      </button>
      <button class="btn-accion btn-password" (click)="activarCambioPassword()" *ngIf="!editMode && !passwordMode">
        ğŸ”’ Cambiar ContraseÃ±a
      </button>
    </div>
  </div>

  <!-- EstadÃ­sticas rÃ¡pidas -->
  <div class="estadisticas-grid" *ngIf="!editMode && !passwordMode">
    <div class="stat-box">
      <div class="stat-icon">âœ…</div>
      <div class="stat-content">
        <p class="stat-value">{{ estadisticas.tareasCompletadas }}</p>
        <p class="stat-label">Tareas Completadas</p>
      </div>
    </div>
    <div class="stat-box">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-content">
        <p class="stat-value">{{ estadisticas.promedio }}%</p>
        <p class="stat-label">Promedio General</p>
      </div>
    </div>
    <div class="stat-box">
      <div class="stat-icon">ğŸ“š</div>
      <div class="stat-content">
        <p class="stat-value">{{ estadisticas.materiasActivas }}</p>
        <p class="stat-label">Materias Activas</p>
      </div>
    </div>
    <div class="stat-box">
      <div class="stat-icon">â±ï¸</div>
      <div class="stat-content">
        <p class="stat-value">{{ estadisticas.horasEstudio }}h</p>
        <p class="stat-label">Horas de Estudio</p>
      </div>
    </div>
  </div>

  <!-- Formulario de ediciÃ³n -->
  <div class="perfil-content" *ngIf="editMode">
    <div class="card">
      <h2 class="card-title">Editar InformaciÃ³n Personal</h2>
      
      <form class="form-perfil">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Nombre</label>
            <input type="text" class="form-input" [(ngModel)]="usuarioTemp.nombre" name="nombre">
          </div>
          <div class="form-group">
            <label class="form-label">Apellido</label>
            <input type="text" class="form-input" [(ngModel)]="usuarioTemp.apellido" name="apellido">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" [(ngModel)]="usuarioTemp.email" name="email">
          </div>
          <div class="form-group">
            <label class="form-label">TelÃ©fono</label>
            <input type="tel" class="form-input" [(ngModel)]="usuarioTemp.telefono" name="telefono">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">DirecciÃ³n</label>
          <input type="text" class="form-input" [(ngModel)]="usuarioTemp.direccion" name="direccion">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Fecha de Nacimiento</label>
            <input type="date" class="form-input" [(ngModel)]="usuarioTemp.fechaNacimiento" name="fechaNacimiento">
          </div>
          <div class="form-group">
            <label class="form-label">Semestre</label>
            <input type="number" class="form-input" [(ngModel)]="usuarioTemp.semestre" name="semestre" min="1" max="10">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Carrera</label>
          <input type="text" class="form-input" [(ngModel)]="usuarioTemp.carrera" name="carrera">
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancelar" (click)="cancelarEdicion()">
            Cancelar
          </button>
          <button type="button" class="btn-guardar" (click)="guardarCambios()">
            Guardar Cambios
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Formulario de cambio de contraseÃ±a -->
  <div class="perfil-content" *ngIf="passwordMode">
    <div class="card">
      <h2 class="card-title">Cambiar ContraseÃ±a</h2>
      
      <form class="form-perfil">
        <div class="form-group">
          <label class="form-label">ContraseÃ±a Actual</label>
          <input type="password" class="form-input" [(ngModel)]="passwordData.actual" name="actual" placeholder="Ingresa tu contraseÃ±a actual">
        </div>

        <div class="form-group">
          <label class="form-label">Nueva ContraseÃ±a</label>
          <input type="password" class="form-input" [(ngModel)]="passwordData.nueva" name="nueva" placeholder="MÃ­nimo 6 caracteres">
        </div>

        <div class="form-group">
          <label class="form-label">Confirmar Nueva ContraseÃ±a</label>
          <input type="password" class="form-input" [(ngModel)]="passwordData.confirmar" name="confirmar" placeholder="Repite la nueva contraseÃ±a">
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancelar" (click)="cancelarCambioPassword()">
            Cancelar
          </button>
          <button type="button" class="btn-guardar" (click)="cambiarPassword()">
            Cambiar ContraseÃ±a
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Vista de informaciÃ³n (no editable) -->
  <div class="perfil-content" *ngIf="!editMode && !passwordMode">
    <div class="card">
      <h2 class="card-title">InformaciÃ³n Personal</h2>
      
      <div class="info-grid">
        <div class="info-item">
          <span class="info-label">ğŸ“§ Email</span>
          <span class="info-value">{{ usuario.email }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">ğŸ“± TelÃ©fono</span>
          <span class="info-value">{{ usuario.telefono }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">ğŸ“ DirecciÃ³n</span>
          <span class="info-value">{{ usuario.direccion }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">ğŸ‚ Fecha de Nacimiento</span>
          <span class="info-value">{{ usuario.fechaNacimiento }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">ğŸ“ Carrera</span>
          <span class="info-value">{{ usuario.carrera }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">ğŸ“– Semestre</span>
          <span class="info-value">{{ usuario.semestre }}</span>
        </div>
      </div>
    </div>
  </div>
</div>
